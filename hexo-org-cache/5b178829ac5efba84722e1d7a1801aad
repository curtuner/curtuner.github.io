{"md5":"2ed19c1fdfee8697b2454f5fe07f936e","content":"\n\n\n<div id=\"outline-container-sec-1\" class=\"outline-2\">\n<h2 id=\"sec-1\"><span class=\"section-number-2\">1</span> 前言</h2>\n<div class=\"outline-text-2\" id=\"text-1\">\n<p>\n这里只讲在我的电脑上如何抓包而已\n</p>\n</div>\n</div>\n<div id=\"outline-container-sec-2\" class=\"outline-2\">\n<h2 id=\"sec-2\"><span class=\"section-number-2\">2</span> wireshark 安装</h2>\n<div class=\"outline-text-2\" id=\"text-2\">\n<p>\n在Arch上直接使用pacman安装就可以了，我这里安装qt版本\n</p>\n<div class=\"org-src-container\">\n\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo pacman -S wireshark-qt</span><br></pre></td></tr></table></figure>\n</div>\n<p>\n安装完之后并不能直接使用，打开wireshark会显示权限不足，这时只要把用户加入wireshark用户组，之后重启电脑即可：\n</p>\n<div class=\"org-src-container\">\n\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo gpasswd <span class=\"operator\">-a</span> <span class=\"variable\">$USER</span> wireshark</span><br></pre></td></tr></table></figure>\n</div>\n</div>\n</div>\n<div id=\"outline-container-sec-3\" class=\"outline-2\">\n<h2 id=\"sec-3\"><span class=\"section-number-2\">3</span> 抓802.11包</h2>\n<div class=\"outline-text-2\" id=\"text-3\">\n</div><div id=\"outline-container-sec-3-1\" class=\"outline-3\">\n<h3 id=\"sec-3-1\"><span class=\"section-number-3\">3.1</span> 建立虚拟网卡</h3>\n<div class=\"outline-text-3\" id=\"text-3-1\">\n<p>\nwireshark默认情况下无法抓取无线网络的管理包。我们可以通过配置无线网卡为monitor模式，来使用wireshark进行抓包。将网卡设为monitor会导致无法联网，如果在使用WiFi会比较麻烦，所以还是生成一个虚拟网卡来监听最好。对于无线网卡，使用 iw 来来代替iwconfig进行操作（使用ip估计不行）：\n</p>\n<div class=\"org-src-container\">\n\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iw dev wlan0 interface add mon0 <span class=\"built_in\">type</span> monitor</span><br><span class=\"line\">ip link <span class=\"built_in\">set</span> mon0 up</span><br></pre></td></tr></table></figure>\n</div>\n<p>\n之后就可以使用Wireshark抓包了\n</p>\n</div>\n</div>\n<div id=\"outline-container-sec-3-2\" class=\"outline-3\">\n<h3 id=\"sec-3-2\"><span class=\"section-number-3\">3.2</span> 802.11帧类型</h3>\n<div class=\"outline-text-3\" id=\"text-3-2\">\n<p>\n为了效率，802.11的帧长度是可变的，所以十分复杂。\n802.11的数据包大体分为3种：\n</p>\n<ol class=\"org-ol\">\n<li>数据：携带更高层次的数据，来自协议栈上层的数据\n</li>\n<li>管理：管理帧负责监督，主要用来加入或退出无线网络，以及处理接入点之间连接的转移事宜\n</li>\n<li>控制：是用来控制对共享媒体(即物理媒介，如光缆)的访问（CSMA/CA）\n</li>\n</ol>\n<p>\n控制帧和数据帧是紧密搭配使用的，管理帧则在一开始和结束起作用。\n对于不同的帧类型有不同的处理方式，所以效率高的方法是在帧的开头就放置元数据。802.11的帧元数据叫frame control：\n</p>\n</div>\n</div>\n\n<div id=\"outline-container-sec-3-3\" class=\"outline-3\">\n<h3 id=\"sec-3-3\"><span class=\"section-number-3\">3.3</span> <span class=\"todo TODO\">TODO</span> 控制帧</h3>\n<div class=\"outline-text-3\" id=\"text-3-3\">\n</div><div id=\"outline-container-sec-3-3-1\" class=\"outline-4\">\n<h4 id=\"sec-3-3-1\"><span class=\"section-number-4\">3.3.1</span> RTS帧</h4>\n<div class=\"outline-text-4\" id=\"text-3-3-1\">\n<p>\nRTS用于申请无线媒介的使用时间，其值为Duration。\n</p>\n</div>\n</div>\n<div id=\"outline-container-sec-3-3-2\" class=\"outline-4\">\n<h4 id=\"sec-3-3-2\"><span class=\"section-number-4\">3.3.2</span> CTS帧</h4>\n<div class=\"outline-text-4\" id=\"text-3-3-2\">\n<p>\n用于回复RTS帧\n</p>\n</div>\n</div>\n<div id=\"outline-container-sec-3-3-3\" class=\"outline-4\">\n<h4 id=\"sec-3-3-3\"><span class=\"section-number-4\">3.3.3</span> ACK帧</h4>\n</div>\n</div>\n\n<div id=\"outline-container-sec-3-4\" class=\"outline-3\">\n<h3 id=\"sec-3-4\"><span class=\"section-number-3\">3.4</span> 管理帧</h3>\n<div class=\"outline-text-3\" id=\"text-3-4\">\n</div><div id=\"outline-container-sec-3-4-1\" class=\"outline-4\">\n<h4 id=\"sec-3-4-1\"><span class=\"section-number-4\">3.4.1</span> Beacon帧</h4>\n<div class=\"outline-text-4\" id=\"text-3-4-1\">\n<p>\nBeacon帧是一个周期发送的帧，用于声明网络，可以通过调整周期来降低设备功耗。STA通过监听Beacon帧来发现网络，所以Beacon帧应包含相应BSS的所有信息。\nBeacon帧的结构图如下：\n<img src=\"./Wireshark抓包分析/beacon帧.jpg\" alt=\"beacon帧.jpg\">\n</p>\n\n<p>\n网络的默认字节序是大端序，而wireshark会把字节序转化为本机字节序再显示。\n先看一个wireshak抓的帧：\n<img src=\"./Wireshark抓包分析/frame基本结构.png\" alt=\"frame基本结构.png\">\n可以看到，除了beacon帧的信息外还提供了额外的信息，实际分析时从第三个开始。Beacon大体分为802.11头部和Beacon信息，其中radiotap header是网卡接收到帧后给wireshark的一些额外信息，记录了信号强度、噪声强度和传输速率等物理层信息。和多数协议一眼，传递数据的帧往往在开头会有元数据，一般处理程序会根据帧的类型来调用相应程序。在802.11中叫frame control，占头两个字节。\n</p>\n</div>\n</div>\n</div>\n\n<div id=\"outline-container-sec-3-5\" class=\"outline-3\">\n<h3 id=\"sec-3-5\"><span class=\"section-number-3\">3.5</span> Probe Request/Response帧</h3>\n</div>\n\n<div id=\"outline-container-sec-3-6\" class=\"outline-3\">\n<h3 id=\"sec-3-6\"><span class=\"section-number-3\">3.6</span> 不同过程抓包分析</h3>\n<div class=\"outline-text-3\" id=\"text-3-6\">\n</div><div id=\"outline-container-sec-3-6-1\" class=\"outline-4\">\n<h4 id=\"sec-3-6-1\"><span class=\"section-number-4\">3.6.1</span> RTS/CTS握手</h4>\n<div class=\"outline-text-4\" id=\"text-3-6-1\">\n<p>\nRTS/CTS模式主要为了解决隐藏终端问题，\n</p>\n</div>\n</div>\n</div>\n<div id=\"outline-container-sec-3-7\" class=\"outline-3\">\n<h3 id=\"sec-3-7\"><span class=\"section-number-3\">3.7</span> 数据帧</h3>\n<div class=\"outline-text-3\" id=\"text-3-7\">\n<p>\n802.11的数据帧是对于LLC帧的包装，\n</p>\n</div>\n</div>\n</div>\n<div id=\"outline-container-sec-4\" class=\"outline-2\">\n<h2 id=\"sec-4\"><span class=\"section-number-2\">4</span> 抓802.1q包</h2>\n<div class=\"outline-text-2\" id=\"text-4\">\n<p>\n电脑默认是抓不到带有vlan tag的包的，所以要设定一个VLAN网口\n</p>\n</div>\n</div>\n<div id=\"outline-container-sec-5\" class=\"outline-2\">\n<h2 id=\"sec-5\"><span class=\"section-number-2\">5</span> 802.11 网络要点</h2>\n<div class=\"outline-text-2\" id=\"text-5\">\n</div><div id=\"outline-container-sec-5-1\" class=\"outline-3\">\n<h3 id=\"sec-5-1\"><span class=\"section-number-3\">5.1</span> 网络类型</h3>\n<div class=\"outline-text-3\" id=\"text-5-1\">\n<ul class=\"org-ul\">\n<li>IBSS\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div id=\"outline-container-sec-6\" class=\"outline-2\">\n<h2 id=\"sec-6\"><span class=\"section-number-2\">6</span> FAQ</h2>\n<div class=\"outline-text-2\" id=\"text-6\">\n</div><div id=\"outline-container-sec-6-1\" class=\"outline-3\">\n<h3 id=\"sec-6-1\"><span class=\"section-number-3\">6.1</span> 1200Mbps的速度是真的吗？</h3>\n<div class=\"outline-text-3\" id=\"text-6-1\">\n<p>\n一般是指2.4G的的速度300Mbps，5G的速度867Mbps，加起来大约有1200Mbps\n</p>\n</div>\n</div>\n</div>\n<div id=\"outline-container-sec-7\" class=\"outline-2\">\n<h2 id=\"sec-7\"><span class=\"section-number-2\">7</span> 零散</h2>\n<div class=\"outline-text-2\" id=\"text-7\">\n<ul class=\"org-ul\">\n<li>802.11是一个靠近底层的协议，表示信息的基本单位是Bit，和我们平常使用byte是不同的，实际上，靠近底层时，这是自然而然的事情。802.11\n</li>\n<li>ssid是一个局域网的id\n</li>\n</ul>\n</div>\n</div>\n<div id=\"outline-container-sec-8\" class=\"outline-2\">\n<h2 id=\"sec-8\"><span class=\"section-number-2\">8</span> 参考</h2>\n<div class=\"outline-text-2\" id=\"text-8\">\n<ul class=\"org-ul\">\n<li><a href=\"http://www.aneasystone.com/archives/2016/08/wireless-analysis-one-monitoring.html\">实战无线网络分析（篇一）无线监听</a>\n</li>\n<li><a href=\"https://wiki.archlinux.org/index.php/VLAN_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)\">Vlan设置</a>\n</li>\n<li><a href=\"http://www.jianshu.com/p/6cc4ea0dc0bc\">802.11 协议（wifi）格式</a>\n</li>\n<li><a href=\"http://blog.csdn.net/rs_network/article/details/50676786\">802.11的Beacon帧</a>\n</li>\n<li>《深入理解android：WiFi模块》\n</li>\n</ul>\n</div>\n</div>\n\nLast Updated 2018-03-04 日 03:01.<br>Render by <a href=\"https://github.com/CodeFalling/hexo-renderer-org\">hexo-renderer-org</a> with <a href=\"http://www.gnu.org/software/emacs/\">Emacs</a> 25.3.1 (<a href=\"http://orgmode.org\">Org</a> mode 8.2.10)\n"}
